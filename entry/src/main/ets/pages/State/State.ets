import { LengthMetricsUnit } from '@kit.ArkUI'

@Entry({ routeName: "StatePage" })
@Component
struct StatePage {
  componentName = "StatePage"

  //Entry ç”Ÿå‘½å‘¨æœŸ
  onPageShow(): void {
    console.log(`${this.componentName} - onPageShow`)
  }

  onPageHide(): void {
    console.log(`${this.componentName} - onPageHide`)
  }

  //Component ç”Ÿå‘½å‘¨æœŸ
  aboutToAppear(): void {
    console.log(`${this.componentName} - aboutToAppear`)
  }

  aboutToDisappear(): void {
    console.log(`${this.componentName} - aboutToDisappear`)
  }

  // aboutToReuse(params: { [key: string]: Any }): void {
  // }
  aboutToRecycle(): void {
    console.log(`${this.componentName} - aboutToRecycle`)
  }

  @State list: StatePageElementModel[] = [
    new StatePageElementModel("111", 1),
    new StatePageElementModel("222", 2),
    new StatePageElementModel("333", 3),
    new StatePageElementModel("444", 4),
    new StatePageElementModel("555", 5),
  ]

  build() {
    this.lazyForEachTest()
  }

  @Builder
  lazyForEachTest() {
    Column() {
      LazyForEach()
    }
  }

  @Builder
  forEachTest() {
    Column() {
      ForEach(this.list, (element: StatePageElementModel, index) => {
        StatePageComponent({ model: element })
        // ä¸‹é¢è¿™ä¹ˆå†™æ˜¯ä¸è¡Œçš„...ğŸ™…
        // Column() {
        //   Row() {
        //     Text(element.name)
        //     Blank().width(20)
        //     Text("${element.age}")
        //   }.height(55).onClick(() => {
        //     this.list[index].name = "å‘µå‘µ"
        //     this.list[index].age = 998
        //   })
        //   Blank().height(1).backgroundColor(Color.Black)
        // }
      }, (item: StatePageElementModel) => {
        return item.name + item.age
      }
      )
    }.backgroundColor(Color.White)
  }
}

class ObjExtendIDataSource implements IDataSource {

  private listeners: DataChangeListener[] = [];
  private originDataArray: string[] = [];

  public totalCount(): number {
    return 0;
  }

  getData(index: number): any {
    throw new Error('Method not implemented.')
  }

  registerDataChangeListener(listener: DataChangeListener): void {
    throw new Error('Method not implemented.')
  }

  unregisterDataChangeListener(listener: DataChangeListener): void {
    throw new Error('Method not implemented.')
  }
}


@Component
struct StatePageComponent {
  @ObjectLink model: StatePageElementModel;

  build() {
    Column() {
      Row() {
        Text(this.model.name)
        Blank().width(20)
        Text("${element.age}")
      }.height(55).onClick(() => {
        this.model.name = "å‘µå‘µ"
        this.model.age = 998
      })

      Blank().height(1).backgroundColor(Color.Black)
    }
  }
}

@Observed
class StatePageElementModel {
  @Track name: string;
  @Track age: number;

  constructor(
    name: string,
    age: number
  ) {
    this.name = name;
    this.age = age;
  }
}


// @Observed
// class Article {
//   id: string;
//   title: string;
//   brief: string;
//   isLiked: boolean;
//   likesCount: number;
//
//   constructor(id: string, title: string, brief: string, isLiked: boolean, likesCount: number) {
//     this.id = id;
//     this.title = title;
//     this.brief = brief;
//     this.isLiked = isLiked;
//     this.likesCount = likesCount;
//   }
// }

// @Entry({ routeName: "StatePage" })
// @Component
// struct ArticleListView {
//   @State articleList: Array<Article> = [
//     new Article('001', 'ç¬¬0ç¯‡æ–‡ç« ', 'æ–‡ç« ç®€ä»‹å†…å®¹', false, 100),
//     new Article('002', 'ç¬¬1ç¯‡æ–‡ç« ', 'æ–‡ç« ç®€ä»‹å†…å®¹', false, 100),
//     new Article('003', 'ç¬¬2ç¯‡æ–‡ç« ', 'æ–‡ç« ç®€ä»‹å†…å®¹', false, 100),
//     new Article('004', 'ç¬¬4ç¯‡æ–‡ç« ', 'æ–‡ç« ç®€ä»‹å†…å®¹', false, 100),
//     new Article('005', 'ç¬¬5ç¯‡æ–‡ç« ', 'æ–‡ç« ç®€ä»‹å†…å®¹', false, 100),
//     new Article('006', 'ç¬¬6ç¯‡æ–‡ç« ', 'æ–‡ç« ç®€ä»‹å†…å®¹', false, 100),
//   ];
//
//   build() {
//     List() {
//       ForEach(this.articleList, (item: Article) => {
//         ListItem() {
//           ArticleCard({
//             article: item
//           })
//             .margin({ top: 20 })
//         }
//       }, (item: Article) => item.id)
//     }
//     .padding(20)
//     .scrollBar(BarState.Off)
//     .backgroundColor(0xF1F3F5)
//   }
// }
//
// @Component
// struct ArticleCard {
//   @ObjectLink article: Article;
//
//   handleLiked() {
//     this.article.isLiked = !this.article.isLiked;
//     this.article.likesCount = this.article.isLiked ? this.article.likesCount + 1 : this.article.likesCount - 1;
//   }
//
//   build() {
//     Row() {
//       Image($r('app.media.app_icon'))
//         .width(80)
//         .height(80)
//         .margin({ right: 20 })
//
//       Column() {
//         Text(this.article.title)
//           .fontSize(20)
//           .margin({ bottom: 8 })
//         Text(this.article.brief)
//           .fontSize(16)
//           .fontColor(Color.Gray)
//           .margin({ bottom: 8 })
//         Row() {
//           // Image(this.article.isLiked ? $r('app.media.') : $r('app.media.iconUnLiked'))
//           //   .width(24)
//           //   .height(24)
//           //   .margin({ right: 8 })
//           Text(this.article.isLiked ? "å–œæ¬¢" : "ä¸å–œæ¬¢")
//           Text(this.article.likesCount.toString())
//             .fontSize(16)
//         }
//         .onClick(() => this.handleLiked())
//         .justifyContent(FlexAlign.Center)
//       }
//       .alignItems(HorizontalAlign.Start)
//       .width('80%')
//       .height('100%')
//     }
//     .padding(20)
//     .borderRadius(12)
//     .backgroundColor('#FFECECEC')
//     .height(120)
//     .width('100%')
//     .justifyContent(FlexAlign.SpaceBetween)
//   }
// }


// Basic implementation of IDataSource to handle data listener
class BasicDataSource implements IDataSource {
  private listeners: DataChangeListener[] = [];

  private originDataArray: string[] = [];

  public totalCount(): number {
    return 0;
  }

  public getData(index: number): string {
    return this.originDataArray[index];
  }

  // è¯¥æ–¹æ³•ä¸ºæ¡†æ¶ä¾§è°ƒç”¨ï¼Œä¸ºLazyForEachç»„ä»¶å‘å…¶æ•°æ®æºå¤„æ·»åŠ listenerç›‘å¬
  registerDataChangeListener(listener: DataChangeListener): void {
    if (this.listeners.indexOf(listener) < 0) {
      console.info('add listener');
      this.listeners.push(listener);
    }
  }

  // è¯¥æ–¹æ³•ä¸ºæ¡†æ¶ä¾§è°ƒç”¨ï¼Œä¸ºå¯¹åº”çš„LazyForEachç»„ä»¶åœ¨æ•°æ®æºå¤„å»é™¤listenerç›‘å¬
  unregisterDataChangeListener(listener: DataChangeListener): void {
    const pos = this.listeners.indexOf(listener);
    if (pos >= 0) {
      console.info('remove listener');
      this.listeners.splice(pos, 1);
    }
  }

  // é€šçŸ¥LazyForEachç»„ä»¶éœ€è¦é‡è½½æ‰€æœ‰å­ç»„ä»¶
  notifyDataReload(): void {
    this.listeners.forEach(listener => {
      listener.onDataReloaded();
    })
  }

  // é€šçŸ¥LazyForEachç»„ä»¶éœ€è¦åœ¨indexå¯¹åº”ç´¢å¼•å¤„æ·»åŠ å­ç»„ä»¶
  notifyDataAdd(index: number): void {
    this.listeners.forEach(listener => {
      listener.onDataAdd(index);
    })
  }

  // é€šçŸ¥LazyForEachç»„ä»¶åœ¨indexå¯¹åº”ç´¢å¼•å¤„æ•°æ®æœ‰å˜åŒ–ï¼Œéœ€è¦é‡å»ºè¯¥å­ç»„ä»¶
  notifyDataChange(index: number): void {
    this.listeners.forEach(listener => {
      listener.onDataChange(index);
    })
  }

  // é€šçŸ¥LazyForEachç»„ä»¶éœ€è¦åœ¨indexå¯¹åº”ç´¢å¼•å¤„åˆ é™¤è¯¥å­ç»„ä»¶
  notifyDataDelete(index: number): void {
    this.listeners.forEach(listener => {
      listener.onDataDelete(index);
    })
  }

  // é€šçŸ¥LazyForEachç»„ä»¶å°†fromç´¢å¼•å’Œtoç´¢å¼•å¤„çš„å­ç»„ä»¶è¿›è¡Œäº¤æ¢
  notifyDataMove(from: number, to: number): void {
    this.listeners.forEach(listener => {
      listener.onDataMove(from, to);
    })
  }
}