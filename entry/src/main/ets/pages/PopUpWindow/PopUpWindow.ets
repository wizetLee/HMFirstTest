import { SymbolGlyphModifier } from '@kit.ArkUI'

@Entry({ routeName: "PopUpWindow" })
@Component
struct PopUpWindow {
  componentName = "PopUpWindow"

  //Entry ç”Ÿå‘½å‘¨æœŸ
  onPageShow(): void {
    console.log(`${this.componentName} - onPageShow`)
  }

  onPageHide(): void {
    console.log(`${this.componentName} - onPageHide`)
  }

  //Component ç”Ÿå‘½å‘¨æœŸ
  aboutToAppear(): void {
    let mi: MyInterface = {
      name: "",
      age: 10,
    }
    console.log(`${this.componentName} - aboutToAppear`)
  }

  aboutToDisappear(): void {
    console.log(`${this.componentName} - aboutToDisappear`)
  }

  // aboutToReuse(params: { [key: string]: Any }): void {
  // }

  aboutToRecycle(): void {
    console.log(`${this.componentName} - aboutToRecycle`)
  }

  @State showBindPopUp: boolean = false;

  build() {
    Column() {
      this.popUpView()
      this.menu()
      this.menu2()
    }
  }

  @Builder
  MenuBuilder() {
    Flex({ direction: FlexDirection.Column, justifyContent: FlexAlign.Center, alignItems: ItemAlign.Center }) {
      Text('Test menu item 1')
        .fontSize(20)
        .width(100)
        .height(50)
        .textAlign(TextAlign.Center)
      Divider().height(10)
      Text('Test menu item 2')
        .fontSize(20)
        .width(100)
        .height(50)
        .textAlign(TextAlign.Center)
    }.width(100)
  }

  /// è‡ªå®šä¹‰èœå•
  @Builder
  menu2() {
    RelativeContainer() {
    }
    .width(100)
    .height(100)
    .backgroundColor(Color.Orange)
    .bindMenu(this.MenuBuilder)
    .bindContextMenu(this.contextMenuBuilder,
      ResponseType.LongPress,
      {
        preview: this.MyPreview,              //WARNING: æ•ˆæžœæœ‰ç‚¹å¡é¡¿
        // preview: MenuPreviewMode.IMAGE,
        previewAnimationOptions:
        {
          scale: [0.8, 1.0],
          hoverScale: [1.0, 0.95], // ä¸€é•œåˆ°åº•çš„æ•ˆæžœï¼Œè®¾ç½®åŽå¡é¡¿çš„é—®é¢˜å¥½è½¬
        },

      }
    )
  }

  @Builder
  MyPreview() {
    Column() {
      // Image($r('app.media.saber'))
      //   .width(200)
      //   .height(200)
      RelativeContainer()
        .width(200)
        .height(200)
        .backgroundColor(Color.Orange)
    }
  }

  @Builder contextMenuBuilder() {
    Flex({ direction: FlexDirection.Column, alignItems: ItemAlign.Center, justifyContent: FlexAlign.Center }) {
      Text('Options')
      Divider().strokeWidth(2).margin(5).color('#F0F0F0')
      Text('Hide')
      Divider().strokeWidth(2).margin(5).color('#F0F0F0')
      Text('Exit')
    }
    .width(200)
  }

  @Builder
  menu() {
    RelativeContainer() {
      
    }
    .width(100)
    .height(100)
    .backgroundColor(Color.Orange)
    .bindMenu(
      [
        {
          value: "menu element 1",
          // icon: // èœå•æ ‡é¢˜å›¾æ ‡

          enabled: true,
          action: () => {
            console.log(`menu element action`)
          },
          symbolIcon: new SymbolGlyphModifier($r('sys.symbol.ohos_photo')).fontSize('24vp'), // è®¾ç½®èœå•é¡¹å›¾æ ‡
        }
      ],
      {
        title: "menu title",
        showInSubWindow: undefined,
        aboutToAppear: () => {

        },
        aboutToDisappear: () => {

        },
        onAppear: () => {
          console.log(`onAppear`)
        },
        onDisappear: () => {
          console.log(`onDisappear`)
        },
        // transition
        // offset
        // placement
        enableArrow: true,
        //FIXME: å¦‚ä½•å¤„ç†
        // preview:
        // previewAnimationOptions:

        backgroundColor: Color.Yellow,
        borderRadius: 1,
      }

    )
  }

  @Builder
  popUpView() {
    RelativeContainer() {

    }
    .width(100)
    .height(100)
    .backgroundColor(Color.Orange)
    .bindPopup(
      this.showBindPopUp // popupå¼¹çª—å¿…é¡»ç­‰å¾…é¡µé¢å…¨éƒ¨æž„å»ºå®Œæˆæ‰èƒ½å±•ç¤ºï¼Œå› æ­¤showä¸èƒ½åœ¨é¡µé¢æž„å»ºä¸­è®¾ç½®ä¸ºtrueï¼Œå¦åˆ™ä¼šå¯¼è‡´popupå¼¹çª—æ˜¾ç¤ºä½ç½®åŠå½¢çŠ¶é”™è¯¯ã€‚
      ,
      {
        message: "å•ŠðŸ¤”",
        messageOptions: {
          textColor: Color.Orange,
          font: {
            size: '14vp',
            style: FontStyle.Italic,
            weight: FontWeight.Bolder
          }
        },
        // placement: Placement.Top,
        primaryButton: {
          value: "primaryButton value",
          action: () => {
            console.log(`primaryButton action`)
            // this.showBindPopUp = false;
          }
        },
        secondaryButton: {
          value: "secondaryButton value",
          action: () => {
            console.log(`secondaryButton action`)
          }
        },
        // arrowOffset: 100, // ç®­å¤´çš„åç§»é‡
        // targetSpace: 100,
        // offset: {
        //   x: 100,
        //   y: 100,
        // },
        popupColor: Color.Pink,
        // autoCancel: false,
        // width: 200, // å¼¹çª—å®½åº¦
        // showInSubWindow: true,
        // arrowHeight: 50,
        // arrowWidth
        radius: 0,
        arrowPointPosition: ArrowPointPosition.CENTER,
        //backgroundBlurStyle: BlurStyle.Thin,
        //transition: new TransitionEffect( // è‡ªå®šä¹‰è®¾ç½®popupå¼¹çª—æ˜¾ç¤ºå’Œé€€å‡ºçš„åŠ¨ç”»æ•ˆæžœã€‚ FIXME: è¿˜ä¸ä¼š

        transition: TransitionEffect.asymmetric(
          TransitionEffect.OPACITY.animation({ duration: 1000, curve: Curve.Ease }).combine(
            TransitionEffect.translate({ x: 50, y: 50 })),
          TransitionEffect.IDENTITY),
        onStateChange: (event) => {
          console.log(`pop up state change ${event.isVisible}`)
          if (event.isVisible) {
            this.showBindPopUp = false;
          }
        },
        onWillDismiss:
        (dismissPopupAction) => {
          let reaseon = dismissPopupAction.reason.toString() // 1 : TOUCH_OUTSIDE
          dismissPopupAction.dismiss();
          return true
        }
      } // é…ç½®å¼¹å‡ºå¼¹çª—çš„å‚æ•°
      ,
    )
    .onClick(() => {
      this.showBindPopUp = true;
    })
  }
}


interface MyInterface {

  offset?: Position;
  name: string,
  age: number,
}